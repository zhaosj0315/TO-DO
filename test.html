<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>待办事项应用 - 功能测试</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .test-container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
        }
        .test-section h2 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        .test-item {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: #fafafa;
            border-radius: 5px;
        }
        .test-item.passed {
            background: rgba(46, 204, 113, 0.1);
            border-left: 4px solid #2ecc71;
        }
        .test-item.failed {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid #e74c3c;
        }
        .test-button {
            padding: 0.5rem 1rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 0.5rem;
        }
        .test-results {
            margin-top: 2rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>待办事项应用 - 功能测试</h1>
        
        <div class="test-section">
            <h2>1. 每周任务多选功能测试</h2>
            <div class="test-item">
                <strong>测试1.1：</strong>验证是否可以选择多个星期几<br>
                <button class="test-button" onclick="testWeekdaySelection()">运行测试</button>
                <span id="test1-1-result"></span>
            </div>
            <div class="test-item">
                <strong>测试1.2：</strong>验证至少选择一个星期几的验证<br>
                <button class="test-button" onclick="testWeekdayValidation()">运行测试</button>
                <span id="test1-2-result"></span>
            </div>
        </div>

        <div class="test-section">
            <h2>2. 任务管理功能测试</h2>
            <div class="test-item">
                <strong>测试2.1：</strong>验证任务添加功能<br>
                <button class="test-button" onclick="testTaskAddition()">运行测试</button>
                <span id="test2-1-result"></span>
            </div>
            <div class="test-item">
                <strong>测试2.2：</strong>验证任务完成功能<br>
                <button class="test-button" onclick="testTaskCompletion()">运行测试</button>
                <span id="test2-2-result"></span>
            </div>
            <div class="test-item">
                <strong>测试2.3：</strong>验证任务删除功能<br>
                <button class="test-button" onclick="testTaskDeletion()">运行测试</button>
                <span id="test2-3-result"></span>
            </div>
        </div>

        <div class="test-section">
            <h2>3. 数据持久化测试</h2>
            <div class="test-item">
                <strong>测试3.1：</strong>验证本地存储功能<br>
                <button class="test-button" onclick="testLocalStorage()">运行测试</button>
                <span id="test3-1-result"></span>
            </div>
        </div>

        <div class="test-section">
            <h2>4. 界面设计测试</h2>
            <div class="test-item">
                <strong>测试4.1：</strong>验证响应式设计<br>
                <button class="test-button" onclick="testResponsiveDesign()">运行测试</button>
                <span id="test4-1-result"></span>
            </div>
        </div>

        <div class="test-results">
            <h2>测试结果汇总</h2>
            <div id="test-summary"></div>
        </div>

        <div style="margin-top: 2rem; text-align: center;">
            <a href="index.html" style="display: inline-block; padding: 1rem 2rem; background: #667eea; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">返回主应用</a>
        </div>
    </div>

    <script>
        // 测试结果计数器
        let passedTests = 0;
        let totalTests = 0;

        // 测试1.1：验证是否可以选择多个星期几
        function testWeekdaySelection() {
            totalTests++;
            const testResult = document.getElementById('test1-1-result');
            const testItem = testResult.parentElement;
            
            // 模拟选择多个星期几
            const weekdays = ['周一', '周三', '周五'];
            
            // 模拟存储到localStorage
            localStorage.setItem('testWeekdays', JSON.stringify(weekdays));
            const retrieved = JSON.parse(localStorage.getItem('testWeekdays'));
            
            if (retrieved && retrieved.length > 1) {
                testResult.textContent = '✓ 通过';
                testItem.className = 'test-item passed';
                passedTests++;
            } else {
                testResult.textContent = '✗ 失败';
                testItem.className = 'test-item failed';
            }
            
            updateSummary();
        }

        // 测试1.2：验证至少选择一个星期几的验证
        function testWeekdayValidation() {
            totalTests++;
            const testResult = document.getElementById('test1-2-result');
            const testItem = testResult.parentElement;
            
            // 模拟空选择
            const emptySelection = [];
            
            if (emptySelection.length === 0) {
                testResult.textContent = '✓ 通过（正确识别空选择）';
                testItem.className = 'test-item passed';
                passedTests++;
            } else {
                testResult.textContent = '✗ 失败';
                testItem.className = 'test-item failed';
            }
            
            updateSummary();
        }

        // 测试2.1：验证任务添加功能
        function testTaskAddition() {
            totalTests++;
            const testResult = document.getElementById('test2-1-result');
            const testItem = testResult.parentElement;
            
            // 模拟任务添加
            const testTask = {
                id: Date.now(),
                text: '测试任务',
                type: 'weekly',
                weekdays: ['周一', '周三'],
                completed: false
            };
            
            // 模拟存储到localStorage
            let tasks = JSON.parse(localStorage.getItem('testTasks')) || [];
            tasks.push(testTask);
            localStorage.setItem('testTasks', JSON.stringify(tasks));
            
            const retrievedTasks = JSON.parse(localStorage.getItem('testTasks'));
            if (retrievedTasks && retrievedTasks.length > 0) {
                testResult.textContent = '✓ 通过';
                testItem.className = 'test-item passed';
                passedTests++;
            } else {
                testResult.textContent = '✗ 失败';
                testItem.className = 'test-item failed';
            }
            
            updateSummary();
        }

        // 测试2.2：验证任务完成功能
        function testTaskCompletion() {
            totalTests++;
            const testResult = document.getElementById('test2-2-result');
            const testItem = testResult.parentElement;
            
            // 模拟任务完成状态切换
            const testTask = {
                id: Date.now(),
                text: '完成测试任务',
                type: 'daily',
                completed: true
            };
            
            if (testTask.completed) {
                testResult.textContent = '✓ 通过';
                testItem.className = 'test-item passed';
                passedTests++;
            } else {
                testResult.textContent = '✗ 失败';
                testItem.className = 'test-item failed';
            }
            
            updateSummary();
        }

        // 测试2.3：验证任务删除功能
        function testTaskDeletion() {
            totalTests++;
            const testResult = document.getElementById('test2-3-result');
            const testItem = testResult.parentElement;
            
            // 模拟任务删除
            let tasks = JSON.parse(localStorage.getItem('testTasks')) || [];
            const initialLength = tasks.length;
            tasks = tasks.filter(task => task.id !== 'non-existent-id');
            
            if (tasks.length === initialLength) {
                testResult.textContent = '✓ 通过（正确处理删除）';
                testItem.className = 'test-item passed';
                passedTests++;
            } else {
                testResult.textContent = '✗ 失败';
                testItem.className = 'test-item failed';
            }
            
            updateSummary();
        }

        // 测试3.1：验证本地存储功能
        function testLocalStorage() {
            totalTests++;
            const testResult = document.getElementById('test3-1-result');
            const testItem = testResult.parentElement;
            
            // 测试localStorage是否可用
            try {
                localStorage.setItem('testStorage', 'test-value');
                const value = localStorage.getItem('testStorage');
                localStorage.removeItem('testStorage');
                
                if (value === 'test-value') {
                    testResult.textContent = '✓ 通过';
                    testItem.className = 'test-item passed';
                    passedTests++;
                } else {
                    testResult.textContent = '✗ 失败';
                    testItem.className = 'test-item failed';
                }
            } catch (e) {
                testResult.textContent = '✗ 失败（localStorage不可用）';
                testItem.className = 'test-item failed';
            }
            
            updateSummary();
        }

        // 测试4.1：验证响应式设计
        function testResponsiveDesign() {
            totalTests++;
            const testResult = document.getElementById('test4-1-result');
            const testItem = testResult.parentElement;
            
            // 检查视口宽度
            const viewportWidth = window.innerWidth;
            
            if (viewportWidth > 0) {
                testResult.textContent = `✓ 通过（当前视口宽度：${viewportWidth}px）`;
                testItem.className = 'test-item passed';
                passedTests++;
            } else {
                testResult.textContent = '✗ 失败';
                testItem.className = 'test-item failed';
            }
            
            updateSummary();
        }

        // 更新测试结果汇总
        function updateSummary() {
            const summary = document.getElementById('test-summary');
            const percentage = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;
            
            summary.innerHTML = `
                <p><strong>总测试数：</strong>${totalTests}</p>
                <p><strong>通过数：</strong>${passedTests}</p>
                <p><strong>失败数：</strong>${totalTests - passedTests}</p>
                <p><strong>通过率：</strong>${percentage}%</p>
            `;
        }

        // 清理测试数据
        function cleanupTestData() {
            localStorage.removeItem('testWeekdays');
            localStorage.removeItem('testTasks');
            localStorage.removeItem('testStorage');
        }

        // 页面加载时清理测试数据
        window.addEventListener('load', cleanupTestData);
        
        // 页面离开时清理测试数据
        window.addEventListener('beforeunload', cleanupTestData);
    </script>
</body>
</html>